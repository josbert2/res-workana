"use strict";function update(){circles.forEach(function(e,t){t<currentActive?(e.classList.add("active"),stepContainer.hide(),$(".container-items-step[data-id="+t+"]").show(),1==t?$("#step_2_btn").show():$("#step_2_btn").hide()):e.classList.remove("active")});var e=document.querySelectorAll(".active");progress.style.width=(e.length-1)/(circles.length-1)*100+"%",1===currentActive||(currentActive===circles.length?next.disabled=!0:next.disabled=!1)}function isMobileDevice(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}function crear_select(){for(var e=document.querySelectorAll("[data-mate-select='active']"),t="",r=0;r<e.length;r++){e[r].setAttribute("data-indx-select",r),e[r].setAttribute("data-selec-open","false");var c=document.querySelectorAll("[data-indx-select='"+r+"'] > .cont_list_select_mate > ul");t=document.querySelectorAll("[data-indx-select='"+r+"'] >select")[0],isMobileDevice()&&t.addEventListener("change",function(){_select_option(t.selectedIndex,r)});var l=t.options;document.querySelectorAll("[data-indx-select='"+r+"']  > .selecionado_opcion ")[0].setAttribute("data-n-select",r),document.querySelectorAll("[data-indx-select='"+r+"']  > .icon_select_mate ")[0].setAttribute("data-n-select",r);for(var n=0;n<l.length;n++)li[n]=document.createElement("li"),1!=l[n].selected&&t.value!=l[n].innerHTML||(li[n].className="active",document.querySelector("[data-indx-select='"+r+"']  > .selecionado_opcion ").innerHTML=l[n].innerHTML),li[n].setAttribute("data-index",n),li[n].setAttribute("data-selec-index",r),li[n].addEventListener("click",function(){_select_option(this.getAttribute("data-index"),this.getAttribute("data-selec-index"))}),li[n].innerHTML=l[n].innerHTML,c[0].appendChild(li[n])}}function open_select(e){var t=e.getAttribute("data-n-select"),r=document.querySelectorAll("[data-indx-select='"+t+"'] .cont_select_int > li"),c=0,l=document.querySelectorAll("[data-indx-select='"+t+"']")[0].getAttribute("data-selec-open"),n=document.querySelectorAll("[data-indx-select='"+t+"'] select")[0];if(isMobileDevice())if(window.document.createEvent){var a=window.document.createEvent("MouseEvents");a.initMouseEvent("mousedown",!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(a)}else n.fireEvent?n.fireEvent("onmousedown"):n.click();else{for(var i=0;i<r.length;i++)c+=r[i].offsetHeight;"false"==l?(document.querySelectorAll("[data-indx-select='"+t+"']")[0].setAttribute("data-selec-open","true"),document.querySelectorAll("[data-indx-select='"+t+"'] > .cont_list_select_mate > ul")[0].style.height=c+"px",document.querySelectorAll("[data-indx-select='"+t+"'] > .icon_select_mate")[0].style.transform="rotate(180deg)"):(document.querySelectorAll("[data-indx-select='"+t+"']")[0].setAttribute("data-selec-open","false"),document.querySelectorAll("[data-indx-select='"+t+"'] > .icon_select_mate")[0].style.transform="rotate(0deg)",document.querySelectorAll("[data-indx-select='"+t+"'] > .cont_list_select_mate > ul")[0].style.height="0px")}}function salir_select(e){document.querySelectorAll("[data-indx-select='"+e+"'] > select")[0];document.querySelectorAll("[data-indx-select='"+e+"'] > .cont_list_select_mate > ul")[0].style.height="0px",document.querySelector("[data-indx-select='"+e+"'] > .icon_select_mate").style.transform="rotate(0deg)",document.querySelectorAll("[data-indx-select='"+e+"']")[0].setAttribute("data-selec-open","false")}function _select_option(e,t){isMobileDevice()&&(t-=1);for(var r=document.querySelectorAll("[data-indx-select='"+t+"'] > select")[0],c=document.querySelectorAll("[data-indx-select='"+t+"'] .cont_select_int > li"),l=(document.querySelectorAll("[data-indx-select='"+t+"'] > .selecionado_opcion")[0].innerHTML=c[e].innerHTML,document.querySelectorAll("[data-indx-select='"+t+"'] > select > option")),n=0;n<c.length;n++)"active"==c[n].className&&(c[n].className=""),c[e].className="active";l[e].selected=!0,r.selectedIndex=e,r.onchange(),salir_select(t)}function revisarDigito(e){var t=e+"";return"0"==t||"1"==t||"2"==t||"3"==t||"4"==t||"5"==t||"6"==t||"7"==t||"8"==t||"9"==t||"k"==t||"K"==t||(alert("Debe ingresar un digito verificador valido"),!1)}function revisarDigito2(e){var t=e.length;if(t<2)return alert("Debe ingresar el rut completo"),!1;if(t>2)var r=e.substring(0,t-1);else var r=e.charAt(0);var c=e.charAt(t-1);if(revisarDigito(c),null==r||null==c)return 0;for(var l="0",n=0,a=2,i=r.length-1;i>=0;i--)n+=r.charAt(i)*a,7==a?a=2:a++;var o=n%11;if(1==o)var l="k";else if(0==o)var l="0";else{var s=11-o;l=s+""}return l==c.toLowerCase()||(alert("El rut es incorrecto"),!1)}function ValidarRut(e){e=[e.slice(0,e.length-1),"-",e.slice(e.length-1)].join("");for(var t="",r=0;r<e.length;r++)" "!=e.charAt(r)&&"."!=e.charAt(r)&&"-"!=e.charAt(r)&&(t+=e.charAt(r));var e=t,c=e.length;if(c<2)return alert("Debe ingresar el rut completo"),!1;for(r=0;r<c;r++)if("0"!=e.charAt(r)&&"1"!=e.charAt(r)&&"2"!=e.charAt(r)&&"3"!=e.charAt(r)&&"4"!=e.charAt(r)&&"5"!=e.charAt(r)&&"6"!=e.charAt(r)&&"7"!=e.charAt(r)&&"8"!=e.charAt(r)&&"9"!=e.charAt(r)&&"k"!=e.charAt(r)&&"K"!=e.charAt(r))return alert("El valor ingresado no corresponde a un R.U.T valido"),!1;var l="";for(r=c-1,i=0;r>=0;r--,i++)l+=e.charAt(r);var n="";n+=l.charAt(0),n+="-";var a=0,i=0;for(r=1,i=2;r<c;r++,i++)3==a?(n+=".",i++,n+=l.charAt(r),a=1):(n+=l.charAt(r),a++);for(l="",r=n.length-1,i=0;r>=0;r--,i++)l+=n.charAt(r);return!!revisarDigito2(e)}function rutFormat(e){for(var t=e.trim(),r=0,c="",l="",n=t.length-1;n>=0;n--)c+=t.charAt(n),n==t.length-1?c+="-":3==r&&(c+=".",r=0),r++;for(var a=c.length-1;a>=0;a--)"."!=c.charAt(c.length-1)?l+=c.charAt(a):a!=c.length-1&&(l+=c.charAt(a));return l.toUpperCase()}function rutFormatBlur(e){var t=e.val();if(e.val(t.toLowerCase().replace(/[^\dk]/g,"").toUpperCase()),""!==(t=e.val())){ValidarRut(t)?e.val(rutFormat(t.toUpperCase())):e.val("")}}var progress=document.getElementById("progress"),next=document.getElementById("next"),circles=document.querySelectorAll(".circle"),stepContainer=$(".container-items-step"),currentActive=1;next.addEventListener("click",function(){currentActive++,currentActive>circles.length&&(currentActive=circles.length),circles.forEach(function(e,t){e.classList.remove("active")}),update()}),window.onload=function(){crear_select()};var li=new Array,cont_slc=0;Number.prototype.formatNumber=function(e,t,r){var c=this,e=isNaN(e=Math.abs(e))?0:e,t=void 0==t?",":t,r=void 0==r?".":r,l=c<0?"-":"",n=String(parseInt(c=Math.abs(Number(c)||0).toFixed(e))),a=(a=n.length)>3?a%3:0;return l+(a?n.substr(0,a)+r:"")+n.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+r)+(e?t+Math.abs(c-n).toFixed(e).slice(2):"")},$("body").on("blur","#rut",function(e){rutFormatBlur($(this)),$(this).keyup()}),$("#step_2_btn").click(function(){$("#titular").hide(),$("#new_benificiario").show(),$(".btn-steps").css("cssText","display:none!important")}),$(".back_to_steps").click(function(){$("#titular").show(),$(".btn-steps").css("cssText","display:flex!important"),$("#new_benificiario").hide()}),$(".items-collapse-primary").click(function(){$(this).next().toggle()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInVwZGF0ZSIsImNpcmNsZXMiLCJmb3JFYWNoIiwiY2lyY2xlIiwiaWR4IiwiY3VycmVudEFjdGl2ZSIsImNsYXNzTGlzdCIsImFkZCIsInN0ZXBDb250YWluZXIiLCJoaWRlIiwiJCIsInNob3ciLCJyZW1vdmUiLCJhY3RpdmVzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwicHJvZ3Jlc3MiLCJzdHlsZSIsIndpZHRoIiwibGVuZ3RoIiwibmV4dCIsImRpc2FibGVkIiwiaXNNb2JpbGVEZXZpY2UiLCJ3aW5kb3ciLCJvcmllbnRhdGlvbiIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsImluZGV4T2YiLCJjcmVhcl9zZWxlY3QiLCJkaXZfY29udF9zZWxlY3QiLCJzZWxlY3RfIiwiZSIsInNldEF0dHJpYnV0ZSIsInVsX2NvbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiX3NlbGVjdF9vcHRpb24iLCJzZWxlY3RlZEluZGV4Iiwic2VsZWN0X29wdGlvbmVzIiwib3B0aW9ucyIsImkiLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJzZWxlY3RlZCIsInZhbHVlIiwiaW5uZXJIVE1MIiwiY2xhc3NOYW1lIiwicXVlcnlTZWxlY3RvciIsInRoaXMiLCJnZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsIm9wZW5fc2VsZWN0IiwiaWR4MSIsInVsX2NvbnRfbGkiLCJoZyIsInNsZWN0X29wZW4iLCJzbGVjdF9lbGVtZW50X29wZW4iLCJjcmVhdGVFdmVudCIsImV2dCIsImluaXRNb3VzZUV2ZW50IiwiZGlzcGF0Y2hFdmVudCIsImZpcmVFdmVudCIsImNsaWNrIiwib2Zmc2V0SGVpZ2h0IiwiaGVpZ2h0IiwidHJhbnNmb3JtIiwic2FsaXJfc2VsZWN0IiwiaW5keCIsInNlbGMiLCJsaV9zIiwib25jaGFuZ2UiLCJyZXZpc2FyRGlnaXRvIiwiZHZyIiwiZHYiLCJhbGVydCIsInJldmlzYXJEaWdpdG8yIiwiY3J1dCIsImxhcmdvIiwicnV0Iiwic3Vic3RyaW5nIiwiY2hhckF0Iiwic3VtYSIsIm11bCIsInJlcyIsImR2aSIsInRvTG93ZXJDYXNlIiwiVmFsaWRhclJ1dCIsInRleHRvIiwic2xpY2UiLCJqb2luIiwidG1wc3RyIiwiaW52ZXJ0aWRvIiwiaiIsImR0ZXh0byIsImNudCIsInJ1dEZvcm1hdCIsInNSdXQxIiwidHJpbSIsIm5Qb3MiLCJzSW52ZXJ0aWRvIiwic1J1dCIsInRvVXBwZXJDYXNlIiwicnV0Rm9ybWF0Qmx1ciIsImVsZW1lbnQiLCJ2YWwiLCJyZXBsYWNlIiwiZ2V0RWxlbWVudEJ5SWQiLCJvbmxvYWQiLCJBcnJheSIsImNvbnRfc2xjIiwiTnVtYmVyIiwicHJvdG90eXBlIiwiZm9ybWF0TnVtYmVyIiwiYyIsImQiLCJ0IiwibiIsImlzTmFOIiwiTWF0aCIsImFicyIsInVuZGVmaW5lZCIsInMiLCJTdHJpbmciLCJwYXJzZUludCIsInRvRml4ZWQiLCJzdWJzdHIiLCJvbiIsImtleXVwIiwiY3NzIiwidG9nZ2xlIl0sIm1hcHBpbmdzIjoiWUEwQkEsU0FBQUEsVUFDQUMsUUFBQUMsUUFBQSxTQUFBQyxFQUFBQyxHQUVBQSxFQUFBQyxlQUNBRixFQUFBRyxVQUFBQyxJQUFBLFVBQ0FDLGNBQUFDLE9BQ0FDLEVBQUEsaUNBQUFOLEVBQUEsS0FBQU8sT0FDQSxHQUFBUCxFQUVBTSxFQUFBLGVBQUFDLE9BRUFELEVBQUEsZUFBQUQsUUFHQU4sRUFBQUcsVUFBQU0sT0FBQSxXQU1BLElBQUFDLEdBQUFDLFNBQUFDLGlCQUFBLFVBRUFDLFVBQUFDLE1BQUFDLE9BQUFMLEVBQUFNLE9BQUEsSUFBQWxCLFFBQUFrQixPQUFBLEdBQUEsSUFBQSxJQUdBLElBQUFkLGdCQUVBQSxnQkFBQUosUUFBQWtCLE9BQ0FDLEtBQUFDLFVBQUEsRUFFQUQsS0FBQUMsVUFBQSxHQVdBLFFBQUFDLGtCQUNBLFdBQUEsS0FBQUMsT0FBQUMsY0FBQSxJQUFBQyxVQUFBQyxVQUFBQyxRQUFBLFlBSUEsUUFBQUMsZ0JBR0EsSUFBQSxHQUZB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LEdBQUFBLEVBQUFwRCxFQUFBcEIsUUFBQSxFQUFBd0UsRUFBQSxFQUFBLENBQ0EsT0FBQTZCLElBQUE3QixFQUFBcEQsRUFBQXFGLE9BQUEsRUFBQWpDLEdBQUF1QixFQUFBLElBQUEzRSxFQUFBcUYsT0FBQWpDLEdBQUFhLFFBQUEsaUJBQUEsS0FBQVUsSUFBQUYsRUFBQUMsRUFBQUksS0FBQUMsSUFBQUgsRUFBQTVFLEdBQUFvRixRQUFBWCxHQUFBekIsTUFBQSxHQUFBLEtBR0E3RSxFQUFBLFFBQUFtSCxHQUFBLE9BQUEsT0FBQSxTQUFBOUYsR0FDQXNFLGNBQUEzRixFQUFBcUMsT0FDQXJDLEVBQUFxQyxNQUFBK0UsVUFvQkFwSCxFQUFBLGVBQUFtRCxNQUFBLFdBQ0FuRCxFQUFBLFlBQUFELE9BQ0FDLEVBQUEscUJBQUFDLE9BQ0FELEVBQUEsY0FBQXFILElBQUEsVUFBQSw0QkFHQXJILEVBQUEsa0JBQUFtRCxNQUFBLFdBQ0FuRCxFQUFBLFlBQUFDLE9BQ0FELEVBQUEsY0FBQXFILElBQUEsVUFBQSwwQkFDQXJILEVBQUEscUJBQUFELFNBS0FDLEVBQUEsMkJBQUFtRCxNQUFBLFdBQ0FuRCxFQUFBcUMsTUFBQTNCLE9BQUE0RyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBwcm9ncmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzcycpXG5cbmNvbnN0IG5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dCcpXG5jb25zdCBjaXJjbGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNpcmNsZScpXG5jb25zdCBzdGVwQ29udGFpbmVyID0gJCgnLmNvbnRhaW5lci1pdGVtcy1zdGVwJylcblxuXG5sZXQgY3VycmVudEFjdGl2ZSA9IDFcblxubmV4dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY3VycmVudEFjdGl2ZSsrXG5cbiAgaWYoY3VycmVudEFjdGl2ZSA+IGNpcmNsZXMubGVuZ3RoKXtcbiAgICBjdXJyZW50QWN0aXZlID0gY2lyY2xlcy5sZW5ndGhcbiAgfVxuICBjaXJjbGVzLmZvckVhY2goKGNpcmNsZSwgaWR4KSA9PiB7XG4gICAgY2lyY2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpXG4gIH0pXG5cbnVwZGF0ZSgpXG4gIC8vY29uc29sZS5sb2coY3VycmVudEFjdGl2ZSlcblxufSlcblxuXG5cbmZ1bmN0aW9uIHVwZGF0ZSgpe1xuICBjaXJjbGVzLmZvckVhY2goKGNpcmNsZSwgaWR4KSA9PiB7XG4gICAgXG4gICAgaWYgKGlkeCA8IGN1cnJlbnRBY3RpdmUpIHtcbiAgICAgIGNpcmNsZS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICAgICAgc3RlcENvbnRhaW5lci5oaWRlKClcbiAgICAgICQoJy5jb250YWluZXItaXRlbXMtc3RlcFtkYXRhLWlkPScgKyBpZHggKyAnXScpLnNob3coKVxuICAgICAgaWYgKGlkeCA9PSAxKXtcbiAgICAgICAgICBcbiAgICAgICAgJCgnI3N0ZXBfMl9idG4nKS5zaG93KClcbiAgICAgIH1lbHNle1xuICAgICAgICAkKCcjc3RlcF8yX2J0bicpLmhpZGUoKVxuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgY2lyY2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpXG4gICAgXG4gICAgfVxuICB9KVxuXG5cbiAgY29uc3QgYWN0aXZlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY3RpdmUnKVxuXG4gIHByb2dyZXNzLnN0eWxlLndpZHRoID0gKGFjdGl2ZXMubGVuZ3RoIC0gMSkgLyAoY2lyY2xlcy5sZW5ndGggLSAxKSAqIDEwMCArICclJ1xuXG5cbiAgaWYoY3VycmVudEFjdGl2ZSA9PT0xKXtcbiAgIFxuICB9ZWxzZSBpZiAoY3VycmVudEFjdGl2ZSA9PT0gY2lyY2xlcy5sZW5ndGgpIHtcbiAgICBuZXh0LmRpc2FibGVkID0gdHJ1ZVxuICB9ZWxzZXtcbiAgICBuZXh0LmRpc2FibGVkID0gZmFsc2VcbiAgfVxufVxuXG5cbi8vIFNFTEVDVCBcblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjcmVhcl9zZWxlY3QoKTtcbn07XG5cbmZ1bmN0aW9uIGlzTW9iaWxlRGV2aWNlKCkge1xuICAgIHJldHVybiB0eXBlb2Ygd2luZG93Lm9yaWVudGF0aW9uICE9PSBcInVuZGVmaW5lZFwiIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIklFTW9iaWxlXCIpICE9PSAtMTtcbn1cblxudmFyIGxpID0gbmV3IEFycmF5KCk7XG5mdW5jdGlvbiBjcmVhcl9zZWxlY3QoKSB7XG4gICAgdmFyIGRpdl9jb250X3NlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1tYXRlLXNlbGVjdD0nYWN0aXZlJ11cIik7XG4gICAgdmFyIHNlbGVjdF8gPSBcIlwiO1xuICAgIGZvciAodmFyIGUgPSAwOyBlIDwgZGl2X2NvbnRfc2VsZWN0Lmxlbmd0aDsgZSsrKSB7XG4gICAgICAgIGRpdl9jb250X3NlbGVjdFtlXS5zZXRBdHRyaWJ1dGUoXCJkYXRhLWluZHgtc2VsZWN0XCIsIGUpO1xuICAgICAgICBkaXZfY29udF9zZWxlY3RbZV0uc2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlYy1vcGVuXCIsIFwiZmFsc2VcIik7XG4gICAgICAgIHZhciB1bF9jb250ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGUgKyBcIiddID4gLmNvbnRfbGlzdF9zZWxlY3RfbWF0ZSA+IHVsXCIpO1xuICAgICAgICBzZWxlY3RfID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGUgKyBcIiddID5zZWxlY3RcIilbMF07XG4gICAgICAgIGlmIChpc01vYmlsZURldmljZSgpKSB7XG4gICAgICAgICAgICBzZWxlY3RfLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZWxlY3Rfb3B0aW9uKHNlbGVjdF8uc2VsZWN0ZWRJbmRleCwgZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2VsZWN0X29wdGlvbmVzID0gc2VsZWN0Xy5vcHRpb25zO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgZSArIFwiJ10gID4gLnNlbGVjaW9uYWRvX29wY2lvbiBcIilbMF0uc2V0QXR0cmlidXRlKFwiZGF0YS1uLXNlbGVjdFwiLCBlKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGUgKyBcIiddICA+IC5pY29uX3NlbGVjdF9tYXRlIFwiKVswXS5zZXRBdHRyaWJ1dGUoXCJkYXRhLW4tc2VsZWN0XCIsIGUpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdF9vcHRpb25lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGlbaV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gICAgICAgICAgICBpZiAoc2VsZWN0X29wdGlvbmVzW2ldLnNlbGVjdGVkID09IHRydWUgfHwgc2VsZWN0Xy52YWx1ZSA9PSBzZWxlY3Rfb3B0aW9uZXNbaV0uaW5uZXJIVE1MKSB7XG4gICAgICAgICAgICAgICAgbGlbaV0uY2xhc3NOYW1lID0gXCJhY3RpdmVcIjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgZSArIFwiJ10gID4gLnNlbGVjaW9uYWRvX29wY2lvbiBcIikuaW5uZXJIVE1MID0gc2VsZWN0X29wdGlvbmVzW2ldLmlubmVySFRNTDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpW2ldLnNldEF0dHJpYnV0ZShcImRhdGEtaW5kZXhcIiwgaSk7XG4gICAgICAgICAgICBsaVtpXS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjLWluZGV4XCIsIGUpO1xuICAgICAgICAgICAgLy8gZnVuY2lvbiBjbGljayBhbCBzZWxlY2lvbmFyXG4gICAgICAgICAgICBsaVtpXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZWxlY3Rfb3B0aW9uKHRoaXMuZ2V0QXR0cmlidXRlKFwiZGF0YS1pbmRleFwiKSwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjLWluZGV4XCIpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsaVtpXS5pbm5lckhUTUwgPSBzZWxlY3Rfb3B0aW9uZXNbaV0uaW5uZXJIVE1MO1xuICAgICAgICAgICAgdWxfY29udFswXS5hcHBlbmRDaGlsZChsaVtpXSk7XG4gICAgICAgIH0gLy8gRmluIEZvciBzZWxlY3Rfb3B0aW9uZXNcbiAgICB9IC8vIGZpbiBmb3IgZGl2c19jb250X3NlbGVjdFxufSAvLyBGaW4gRnVuY3Rpb25cblxudmFyIGNvbnRfc2xjID0gMDtcbmZ1bmN0aW9uIG9wZW5fc2VsZWN0KGlkeCkge1xuICAgIHZhciBpZHgxID0gaWR4LmdldEF0dHJpYnV0ZShcImRhdGEtbi1zZWxlY3RcIik7XG4gICAgdmFyIHVsX2NvbnRfbGkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgaWR4MSArIFwiJ10gLmNvbnRfc2VsZWN0X2ludCA+IGxpXCIpO1xuICAgIHZhciBoZyA9IDA7XG4gICAgdmFyIHNsZWN0X29wZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgaWR4MSArIFwiJ11cIilbMF0uZ2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlYy1vcGVuXCIpO1xuICAgIHZhciBzbGVjdF9lbGVtZW50X29wZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgaWR4MSArIFwiJ10gc2VsZWN0XCIpWzBdO1xuICAgIGlmIChpc01vYmlsZURldmljZSgpKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRXZlbnQpIHtcbiAgICAgICAgICAgIC8vIEFsbFxuICAgICAgICAgICAgdmFyIGV2dCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFdmVudChcIk1vdXNlRXZlbnRzXCIpO1xuICAgICAgICAgICAgZXZ0LmluaXRNb3VzZUV2ZW50KFwibW91c2Vkb3duXCIsIGZhbHNlLCB0cnVlLCB3aW5kb3csIDAsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTtcbiAgICAgICAgICAgIHNsZWN0X2VsZW1lbnRfb3Blbi5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2xlY3RfZWxlbWVudF9vcGVuLmZpcmVFdmVudCkge1xuICAgICAgICAgICAgLy8gSUVcbiAgICAgICAgICAgIHNsZWN0X2VsZW1lbnRfb3Blbi5maXJlRXZlbnQoXCJvbm1vdXNlZG93blwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNsZWN0X2VsZW1lbnRfb3Blbi5jbGljaygpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1bF9jb250X2xpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBoZyArPSB1bF9jb250X2xpW2ldLm9mZnNldEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2xlY3Rfb3BlbiA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBpZHgxICsgXCInXVwiKVswXS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjLW9wZW5cIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGlkeDEgKyBcIiddID4gLmNvbnRfbGlzdF9zZWxlY3RfbWF0ZSA+IHVsXCIpWzBdLnN0eWxlLmhlaWdodCA9IGhnICsgXCJweFwiO1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGlkeDEgKyBcIiddID4gLmljb25fc2VsZWN0X21hdGVcIilbMF0uc3R5bGUudHJhbnNmb3JtID0gXCJyb3RhdGUoMTgwZGVnKVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGlkeDEgKyBcIiddXCIpWzBdLnNldEF0dHJpYnV0ZShcImRhdGEtc2VsZWMtb3BlblwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWluZHgtc2VsZWN0PSdcIiArIGlkeDEgKyBcIiddID4gLmljb25fc2VsZWN0X21hdGVcIilbMF0uc3R5bGUudHJhbnNmb3JtID0gXCJyb3RhdGUoMGRlZylcIjtcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBpZHgxICsgXCInXSA+IC5jb250X2xpc3Rfc2VsZWN0X21hdGUgPiB1bFwiKVswXS5zdHlsZS5oZWlnaHQgPSBcIjBweFwiO1xuICAgICAgICB9XG4gICAgfVxufSAvLyBmaW4gZnVuY3Rpb24gb3Blbl9zZWxlY3RcblxuZnVuY3Rpb24gc2FsaXJfc2VsZWN0KGluZHgpIHtcbiAgICB2YXIgc2VsZWN0XyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBpbmR4ICsgXCInXSA+IHNlbGVjdFwiKVswXTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgaW5keCArIFwiJ10gPiAuY29udF9saXN0X3NlbGVjdF9tYXRlID4gdWxcIilbMF0uc3R5bGUuaGVpZ2h0ID0gXCIwcHhcIjtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgaW5keCArIFwiJ10gPiAuaWNvbl9zZWxlY3RfbWF0ZVwiKS5zdHlsZS50cmFuc2Zvcm0gPSBcInJvdGF0ZSgwZGVnKVwiO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBpbmR4ICsgXCInXVwiKVswXS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjLW9wZW5cIiwgXCJmYWxzZVwiKTtcbn1cblxuZnVuY3Rpb24gX3NlbGVjdF9vcHRpb24oaW5keCwgc2VsYykge1xuICAgIGlmIChpc01vYmlsZURldmljZSgpKSB7XG4gICAgICAgIHNlbGMgPSBzZWxjIC0gMTtcbiAgICB9XG4gICAgdmFyIHNlbGVjdF8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgc2VsYyArIFwiJ10gPiBzZWxlY3RcIilbMF07XG5cbiAgICB2YXIgbGlfcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBzZWxjICsgXCInXSAuY29udF9zZWxlY3RfaW50ID4gbGlcIik7XG4gICAgdmFyIHBfYWN0ID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1pbmR4LXNlbGVjdD0nXCIgKyBzZWxjICsgXCInXSA+IC5zZWxlY2lvbmFkb19vcGNpb25cIilbMF0uaW5uZXJIVE1MID0gbGlfc1tpbmR4XS5pbm5lckhUTUwpO1xuICAgIHZhciBzZWxlY3Rfb3B0aW9uZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtaW5keC1zZWxlY3Q9J1wiICsgc2VsYyArIFwiJ10gPiBzZWxlY3QgPiBvcHRpb25cIik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaV9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChsaV9zW2ldLmNsYXNzTmFtZSA9PSBcImFjdGl2ZVwiKSB7XG4gICAgICAgICAgICBsaV9zW2ldLmNsYXNzTmFtZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgbGlfc1tpbmR4XS5jbGFzc05hbWUgPSBcImFjdGl2ZVwiO1xuICAgIH1cbiAgICBzZWxlY3Rfb3B0aW9uZXNbaW5keF0uc2VsZWN0ZWQgPSB0cnVlO1xuICAgIHNlbGVjdF8uc2VsZWN0ZWRJbmRleCA9IGluZHg7XG4gICAgc2VsZWN0Xy5vbmNoYW5nZSgpO1xuICAgIHNhbGlyX3NlbGVjdChzZWxjKTtcbn1cblxuXG5mdW5jdGlvbiByZXZpc2FyRGlnaXRvKGR2cikge1xuICAgIHZhciBkdiA9IGR2ciArIFwiXCJcbiAgICBpZiAoZHYgIT0gJzAnICYmIGR2ICE9ICcxJyAmJiBkdiAhPSAnMicgJiYgZHYgIT0gJzMnICYmIGR2ICE9ICc0JyAmJiBkdiAhPSAnNScgJiYgZHYgIT0gJzYnICYmIGR2ICE9ICc3JyAmJiBkdiAhPSAnOCcgJiYgZHYgIT0gJzknICYmIGR2ICE9ICdrJyAmJiBkdiAhPSAnSycpIHtcbiAgICAgICAgYWxlcnQoJ0RlYmUgaW5ncmVzYXIgdW4gZGlnaXRvIHZlcmlmaWNhZG9yIHZhbGlkbycpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiByZXZpc2FyRGlnaXRvMihjcnV0KSB7XG4gICAgdmFyIGxhcmdvID0gY3J1dC5sZW5ndGg7XG4gICAgaWYgKGxhcmdvIDwgMikge1xuICAgICAgICBhbGVydCgnRGViZSBpbmdyZXNhciBlbCBydXQgY29tcGxldG8nKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChsYXJnbyA+IDIpXG4gICAgICAgIHZhciBydXQgPSBjcnV0LnN1YnN0cmluZygwLCBsYXJnbyAtIDEpO1xuICAgIGVsc2VcbiAgICAgICB2YXIgcnV0ID0gY3J1dC5jaGFyQXQoMCk7XG4gICAgdmFyIGR2ID0gY3J1dC5jaGFyQXQobGFyZ28gLSAxKTtcbiAgICByZXZpc2FyRGlnaXRvKGR2KTtcblxuICAgIGlmIChydXQgPT0gbnVsbCB8fCBkdiA9PSBudWxsKVxuICAgICAgICByZXR1cm4gMFxuXG4gICAgdmFyIGR2ciA9ICcwJ1xuICAgIHZhciBzdW1hID0gMFxuICAgIHZhciBtdWwgPSAyXG5cbiAgICBmb3IgKHZhciBpID0gcnV0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHN1bWEgPSBzdW1hICsgcnV0LmNoYXJBdChpKSAqIG11bFxuICAgICAgICBpZiAobXVsID09IDcpXG4gICAgICAgICAgICBtdWwgPSAyXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG11bCsrXG4gICAgfVxuICAgIHZhciByZXMgPSBzdW1hICUgMTFcbiAgICBpZiAocmVzID09IDEpXG4gICAgICAgIHZhciBkdnIgPSAnaydcbiAgICBlbHNlIGlmIChyZXMgPT0gMClcbiAgICAgICAgdmFyIGR2ciA9ICcwJ1xuICAgIGVsc2Uge1xuICAgICAgICB2YXIgZHZpID0gMTEgLSByZXNcbiAgICAgICAgZHZyID0gZHZpICsgXCJcIlxuICAgIH1cbiAgICBpZiAoZHZyICE9IGR2LnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgYWxlcnQoJ0VsIHJ1dCBlcyBpbmNvcnJlY3RvJylcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gVmFsaWRhclJ1dCh0ZXh0bykge1xuICAgIHRleHRvID0gW3RleHRvLnNsaWNlKDAsIHRleHRvLmxlbmd0aCAtIDEpLCAnLScsIHRleHRvLnNsaWNlKHRleHRvLmxlbmd0aCAtIDEpXS5qb2luKCcnKTtcbiAgICB2YXIgdG1wc3RyID0gXCJcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHRvLmxlbmd0aDsgaSsrKVxuICAgICAgICBpZiAodGV4dG8uY2hhckF0KGkpICE9ICcgJyAmJiB0ZXh0by5jaGFyQXQoaSkgIT0gJy4nICYmIHRleHRvLmNoYXJBdChpKSAhPSAnLScpXG4gICAgICAgICAgICB0bXBzdHIgPSB0bXBzdHIgKyB0ZXh0by5jaGFyQXQoaSk7XG4gICAgdmFyIHRleHRvID0gdG1wc3RyO1xuICAgIHZhciBsYXJnbyA9IHRleHRvLmxlbmd0aDtcblxuICAgIGlmIChsYXJnbyA8IDIpIHtcbiAgICAgICAgYWxlcnQoJ0RlYmUgaW5ncmVzYXIgZWwgcnV0IGNvbXBsZXRvJylcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZvciAoaSA9IDA7IGkgPCBsYXJnbzsgaSsrKSB7XG4gICAgICAgIGlmICh0ZXh0by5jaGFyQXQoaSkgIT0gXCIwXCIgJiYgdGV4dG8uY2hhckF0KGkpICE9IFwiMVwiICYmIHRleHRvLmNoYXJBdChpKSAhPSBcIjJcIiAmJiB0ZXh0by5jaGFyQXQoaSkgIT0gXCIzXCIgJiYgdGV4dG8uY2hhckF0KGkpICE9IFwiNFwiICYmIHRleHRvLmNoYXJBdChpKSAhPSBcIjVcIiAmJiB0ZXh0by5jaGFyQXQoaSkgIT0gXCI2XCIgJiYgdGV4dG8uY2hhckF0KGkpICE9IFwiN1wiICYmIHRleHRvLmNoYXJBdChpKSAhPSBcIjhcIiAmJiB0ZXh0by5jaGFyQXQoaSkgIT0gXCI5XCIgJiYgdGV4dG8uY2hhckF0KGkpICE9IFwia1wiICYmIHRleHRvLmNoYXJBdChpKSAhPSBcIktcIikge1xuICAgICAgICAgICAgYWxlcnQoJ0VsIHZhbG9yIGluZ3Jlc2FkbyBubyBjb3JyZXNwb25kZSBhIHVuIFIuVS5UIHZhbGlkbycpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGludmVydGlkbyA9IFwiXCI7XG4gICAgZm9yIChpID0gKGxhcmdvIC0gMSksIGogPSAwOyBpID49IDA7IGktLSwgaisrKVxuICAgICAgICBpbnZlcnRpZG8gPSBpbnZlcnRpZG8gKyB0ZXh0by5jaGFyQXQoaSk7XG4gICAgdmFyIGR0ZXh0byA9IFwiXCI7XG4gICAgZHRleHRvID0gZHRleHRvICsgaW52ZXJ0aWRvLmNoYXJBdCgwKTtcbiAgICBkdGV4dG8gPSBkdGV4dG8gKyAnLSc7XG4gICAgdmFyIGNudCA9IDA7XG4gICAgdmFyIGogPSAwXG4gICAgZm9yIChpID0gMSwgaiA9IDI7IGkgPCBsYXJnbzsgaSsrLCBqKyspIHtcbiAgICAgICAgLy9hbGVydChcImk9W1wiICsgaSArIFwiXSBqPVtcIiArIGogK1wiXVwiICk7XG4gICAgICAgIGlmIChjbnQgPT0gMykge1xuICAgICAgICAgICAgZHRleHRvID0gZHRleHRvICsgJy4nO1xuICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgZHRleHRvID0gZHRleHRvICsgaW52ZXJ0aWRvLmNoYXJBdChpKTtcbiAgICAgICAgICAgIGNudCA9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkdGV4dG8gPSBkdGV4dG8gKyBpbnZlcnRpZG8uY2hhckF0KGkpO1xuICAgICAgICAgICAgY250Kys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbnZlcnRpZG8gPSBcIlwiO1xuICAgIGZvciAoaSA9IChkdGV4dG8ubGVuZ3RoIC0gMSksIGogPSAwOyBpID49IDA7IGktLSwgaisrKVxuICAgICAgICBpbnZlcnRpZG8gPSBpbnZlcnRpZG8gKyBkdGV4dG8uY2hhckF0KGkpO1xuXG4gICAgLy8kKCdbaWQkPV9ydXRdJykudmFsKGludmVydGlkby50b1VwcGVyQ2FzZSgpKTtcblxuICAgIGlmIChyZXZpc2FyRGlnaXRvMih0ZXh0bykpXG4gICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBydXRGb3JtYXQodmFsdWUpIHtcbiAgICB2YXIgc1J1dDEgPSB2YWx1ZS50cmltKCk7XG4gICAgdmFyIG5Qb3MgPSAwO1xuICAgIHZhciBzSW52ZXJ0aWRvID0gXCJcIjtcbiAgICB2YXIgc1J1dCA9IFwiXCI7XG4gICAgZm9yICh2YXIgaSA9IHNSdXQxLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHNJbnZlcnRpZG8gKz0gc1J1dDEuY2hhckF0KGkpO1xuICAgICAgICBpZiAoaSA9PSBzUnV0MS5sZW5ndGggLSAxKVxuICAgICAgICAgICAgc0ludmVydGlkbyArPSBcIi1cIjtcbiAgICAgICAgZWxzZSBpZiAoblBvcyA9PSAzKSB7XG4gICAgICAgICAgICBzSW52ZXJ0aWRvICs9IFwiLlwiO1xuICAgICAgICAgICAgblBvcyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgblBvcysrO1xuICAgIH1cbiAgICBmb3IgKHZhciBqID0gc0ludmVydGlkby5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xuICAgICAgICBpZiAoc0ludmVydGlkby5jaGFyQXQoc0ludmVydGlkby5sZW5ndGggLSAxKSAhPSBcIi5cIilcbiAgICAgICAgICAgIHNSdXQgKz0gc0ludmVydGlkby5jaGFyQXQoaik7XG4gICAgICAgIGVsc2UgaWYgKGogIT0gc0ludmVydGlkby5sZW5ndGggLSAxKVxuICAgICAgICAgICAgc1J1dCArPSBzSW52ZXJ0aWRvLmNoYXJBdChqKTtcblxuICAgIH1cbiAgICByZXR1cm4gc1J1dC50b1VwcGVyQ2FzZSgpO1xufVxuXG5OdW1iZXIucHJvdG90eXBlLmZvcm1hdE51bWJlciA9IGZ1bmN0aW9uIChjLCBkLCB0KSB7XG4gICAgdmFyIG4gPSB0aGlzLFxuICAgICAgICBjID0gaXNOYU4oYyA9IE1hdGguYWJzKGMpKSA/IDAgOiBjLFxuICAgICAgICBkID0gZCA9PSB1bmRlZmluZWQgPyBcIixcIiA6IGQsXG4gICAgICAgIHQgPSB0ID09IHVuZGVmaW5lZCA/IFwiLlwiIDogdCxcbiAgICAgICAgcyA9IG4gPCAwID8gXCItXCIgOiBcIlwiLFxuICAgICAgICBpID0gU3RyaW5nKHBhcnNlSW50KG4gPSBNYXRoLmFicyhOdW1iZXIobikgfHwgMCkudG9GaXhlZChjKSkpLFxuICAgICAgICBqID0gKGogPSBpLmxlbmd0aCkgPiAzID8gaiAlIDMgOiAwO1xuICAgIHJldHVybiBzICsgKGogPyBpLnN1YnN0cigwLCBqKSArIHQgOiBcIlwiKSArIGkuc3Vic3RyKGopLnJlcGxhY2UoLyhcXGR7M30pKD89XFxkKS9nLCBcIiQxXCIgKyB0KSArIChjID8gZCArIE1hdGguYWJzKG4gLSBpKS50b0ZpeGVkKGMpLnNsaWNlKDIpIDogXCJcIik7XG59O1xuXG4kKCdib2R5Jykub24oJ2JsdXInLCAnI3J1dCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgcnV0Rm9ybWF0Qmx1cigkKHRoaXMpKTtcbiAgICAkKHRoaXMpLmtleXVwKCk7XG5cbn0pO1xuXG5mdW5jdGlvbiBydXRGb3JtYXRCbHVyKGVsZW1lbnQpXG57XG4gICAgdmFyIHZhbCA9IGVsZW1lbnQudmFsKCk7XG4gICAgLy9lbGVtZW50LnZhbChydXRGb3JtYXQoZWxlbWVudC52YWwoKS50b1VwcGVyQ2FzZSgpKSk7XG4gICAgZWxlbWVudC52YWwodmFsLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXGRrXS9nLCBcIlwiKS50b1VwcGVyQ2FzZSgpKTtcbiAgICB2YWwgPSBlbGVtZW50LnZhbCgpO1xuICAgIGlmICh2YWwgIT09ICcnKSB7XG4gICAgICAgIHZhciBydXQgPSBWYWxpZGFyUnV0KHZhbCk7XG4gICAgICAgIGlmIChydXQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQudmFsKHJ1dEZvcm1hdCh2YWwudG9VcHBlckNhc2UoKSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC52YWwoJycpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4kKCcjc3RlcF8yX2J0bicpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgJCgnI3RpdHVsYXInKS5oaWRlKClcbiAgICAkKCcjbmV3X2JlbmlmaWNpYXJpbycpLnNob3coKVxuICAgICQoJy5idG4tc3RlcHMnKS5jc3MoJ2Nzc1RleHQnLCAnZGlzcGxheTpub25lIWltcG9ydGFudCcpO1xufSlcblxuJCgnLmJhY2tfdG9fc3RlcHMnKS5jbGljayhmdW5jdGlvbigpe1xuICAgICQoJyN0aXR1bGFyJykuc2hvdygpXG4gICAgJCgnLmJ0bi1zdGVwcycpLmNzcygnY3NzVGV4dCcsICdkaXNwbGF5OmZsZXghaW1wb3J0YW50Jyk7XG4gICAgJCgnI25ld19iZW5pZmljaWFyaW8nKS5oaWRlKClcbiAgICBcbn0pXG5cblxuJCgnLml0ZW1zLWNvbGxhcHNlLXByaW1hcnknKS5jbGljayhmdW5jdGlvbigpe1xuICAgICQodGhpcykubmV4dCgpLnRvZ2dsZSgpO1xufSk7Il19
